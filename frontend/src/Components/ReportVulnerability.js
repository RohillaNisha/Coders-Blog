import React, {useState} from "react";
import DOMPurify from "dompurify";

function ReportVulnerability(){
    const [category, setCategory] = useState("")
    const [description, setDescription] = useState("")
    const [reportedBy, setReportedBy] = useState("")
    const [contactDetails, setContactDetails] = useState("")



    async function reportVulnerability(event){
        event.preventDefault()

        if (!description || !reportedBy) {
            alert("Please fill out both Description and Your Name fields.");
            return;
        }

        const res = await fetch("http://localhost:8080/api/vulnerability/add", {
            method: "POST",
            body: JSON.stringify( {vulCategory: category, description: description, reportedBy: reportedBy, contactDetails: contactDetails}),
            credentials: "include",
            headers: {
                'Content-Type' : 'application/json',
            }
        })
        const result = res.ok
        if(result){
            alert("Vulnerability reported!")
            setCategory("")
            setDescription("")
            setReportedBy("")
            setContactDetails("")
        }else alert("Something went wrong")
    }

    return (
        <div className= "container mt-5 border border-secondary rounded p-4">
        <form >
            <div className="form-row">
                <div className="col mb-3">
                    <label className="form-label">Category of Vulnerability </label>
                    <input
                        type="text"
                        className="form-control"
                        id="category"
                        placeholder="XSS, SQL injection , CSRF etc.."
                        value={DOMPurify.sanitize(category)}
                        onChange={(event) => {
                            setCategory(event.target.value);
                        }}
                    />
                </div>
                <div className="col mb-3">
                    <label className="form-label">Description</label>
                    <input
                        type="text"
                        className="form-control"
                        id="description"
                        placeholder="Please describe here..."
                        value={DOMPurify.sanitize(description)}
                        onChange={(event) => {
                            setDescription(event.target.value);
                        }}
                    />
                </div>
                <div className="col mb-3">
                    <label className="form-label">Your Name </label>
                    <input
                        type="text"
                        className="form-control"
                        id="reported-by"
                        value={DOMPurify.sanitize(reportedBy)}
                        onChange={(event) => {
                            setReportedBy(event.target.value);
                        }}
                    />
                </div>
                <div className="col mb-3">
                    <label className="form-label">Contact Details</label>
                    <input
                        type="text"
                        className="form-control"
                        id="contact-details"
                        value={DOMPurify.sanitize(contactDetails)}
                        onChange={(event) => {
                            setContactDetails(event.target.value);
                        }}
                    />
                </div>
            </div>
            <button type="button" className="btn btn-primary" onClick={reportVulnerability}>
                Report
            </button>
        </form>
        </div>
    )

}

export default ReportVulnerability